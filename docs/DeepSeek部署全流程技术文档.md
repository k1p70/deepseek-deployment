# DeepSeek LLM 部署全流程技术文档
## 文档版本
| 版本号 | 修订日期 | 修订内容 | 修订人 |
|--------|----------|----------|--------|
| V1.0 | 2026-02-28 | 完成全流程部署指南与优化方案编写 | k70p2(吴辉) |

## 一、文档概述
本文档为DeepSeek开源大语言模型全流程部署与优化的完整技术指南，覆盖从基础环境搭建、本地部署、容器化部署、自动化部署、性能优化全生命周期，可作为项目交付的核心技术文档，也可作为后续运维的操作手册。
- 适用对象：开发人员、运维人员、项目考察评审人员
- 适用版本：DeepSeek 1.3B/1.5B/2B 开源对话模型
- 运行环境：Ubuntu Linux 20.04+，支持CPU/GPU推理

## 二、项目概述
### 2.1 项目背景
本项目为DeepSeek开源大语言模型的部署实践与优化，目标是在Linux环境下完成模型的完整部署，实现高可用、高性能的推理服务，并完成全流程工程化落地，包含4个阶段：基础环境搭建、依赖安装与本地部署、容器化部署与性能优化、自动化部署与创新优化。

### 2.2 核心技术栈
| 技术组件 | 版本要求 | 核心作用 |
|----------|----------|----------|
| 操作系统 | Ubuntu 20.04/22.04/24.04 LTS | 服务运行基础环境 |
| Python | 3.10 ~ 3.12 | 项目开发与运行语言 |
| Git | 2.30+ | 代码版本控制 |
| Docker | 25.0+ | 容器化部署 |
| docker-compose | 2.20+ | 服务编排 |
| MySQL | 8.0+ | 业务数据持久化存储 |
| Redis | 7.0+ | 缓存与会话管理 |
| FastAPI | 0.100+ | Web服务框架 |
| Uvicorn | 0.20+ | ASGI服务网关 |
| Hugging Face Transformers | 4.36+ | 模型加载与推理 |

### 2.3 环境要求
| 环境类型 | 最低配置 | 推荐配置 |
|----------|----------|----------|
| CPU环境 | 4核CPU，8G内存 | 8核CPU，16G内存 |
| GPU环境 | NVIDIA GPU 8G显存，CUDA 11.8+ | NVIDIA GPU 16G+显存，CUDA 12.0+ |
| 磁盘空间 | 100G SSD | 200G+ SSD |
| 网络 | 可访问外网 | 固定公网IP，带宽10M+ |

## 三、部署指南
### 3.1 基础环境搭建（Week1）
#### 3.1.1 Ubuntu系统安装与配置
1.  虚拟机/物理机安装Ubuntu 24.04 LTS桌面版/服务器版
2.  配置SSH远程连接，开启SSH服务并设置开机自启
3.  更换国内软件源，更新系统软件包
4.  安装Git、Vim、tree等基础开发工具

#### 3.1.2 Git与GitHub配置
1.  创建GitHub账号，完成Git全局用户名与邮箱配置
2.  生成SSH密钥并添加到GitHub，实现免密提交
3.  创建个人项目仓库，完成Git clone/commit/push核心操作

#### 3.1.3 项目源码获取与分析
1.  克隆DeepSeek官方项目源码：`git clone https://github.com/deepseek-ai/DeepSeek-LLM.git`
2.  分析项目目录结构，撰写Markdown格式的项目结构分析文档
3.  提交项目结构文档到个人GitHub仓库，保留完整commit记录

### 3.2 本地部署与依赖配置（Week2）
#### 3.2.1 Python虚拟环境配置
1.  安装对应版本的Python与python3-venv依赖
2.  创建项目专属Python虚拟环境：`python3 -m venv deepseek-env`
3.  激活虚拟环境：`source deepseek-env/bin/activate`
4.  配置pip国内镜像源，升级pip到最新版本

#### 3.2.2 项目依赖安装
1.  通过requirements.txt一键安装项目全量Python依赖
2.  安装pymysql、redis等数据库驱动依赖
3.  解决依赖安装过程中的编译、网络、版本冲突等问题

#### 3.2.3 依赖服务部署
1.  安装MySQL 8.0服务，设置开机自启，完成安全初始化
2.  创建项目专属数据库与用户，配置数据库权限
3.  安装Redis服务，设置开机自启，配置访问密码与持久化
4.  验证MySQL与Redis服务可正常连接与读写

#### 3.2.4 模型下载与服务启动
1.  通过ModelScope/Hugging Face下载DeepSeek预训练对话模型
2.  编写.env环境配置文件，配置模型路径、数据库、Redis等参数
3.  完成数据库表结构初始化，验证模型可正常加载与推理
4.  启动Uvicorn服务，验证接口可正常访问，完成本地运行

### 3.3 容器化部署与性能优化（Week3）
#### 3.3.1 Docker环境安装
1.  卸载系统旧版本Docker，添加Docker官方软件源
2.  安装Docker CE与docker-compose插件
3.  配置Docker开机自启，配置国内镜像源，提升镜像拉取速度
4.  验证Docker与docker-compose可正常使用

#### 3.3.2 项目容器化构建
1.  编写多阶段构建Dockerfile，优化镜像体积与安全性
2.  配置容器健康检查、非root用户运行、端口暴露等配置
3.  构建Docker镜像，验证镜像可正常构建，无报错

#### 3.3.3 服务编排部署
1.  编写docker-compose.yml，编排DeepSeek服务、MySQL、Redis三大组件
2.  配置服务间网络互通、数据卷持久化、环境变量注入、启动依赖
3.  配置服务重启策略、资源限制、性能优化参数
4.  一键启动全栈服务：`docker compose up -d`
5.  验证所有容器正常运行，服务接口可正常访问

#### 3.3.4 性能测试与优化
1.  使用wrk/JMeter完成服务基准压力测试，定位性能瓶颈
2.  从容器配置、服务参数、连接池、应用逻辑四个维度完成优化
3.  对比优化前后的QPS、延迟、错误率等核心指标，验证优化效果
4.  撰写压力测试与优化报告，记录优化过程与结果

### 3.4 自动化部署与全流程落地（Week4）
#### 3.4.1 自动化部署脚本开发
1.  编写Shell自动化部署脚本，覆盖系统初始化、Docker安装、代码拉取、配置生成、服务启动全流程
2.  增加错误处理、日志输出、健康检查机制，保证脚本健壮性
3.  实现一键部署，无需人工干预即可完成全流程环境搭建与服务启动

#### 3.4.2 服务运维与监控
1.  配置Docker容器日志轮转，避免日志占用磁盘空间过大
2.  实现服务开机自启，服务器重启后自动恢复服务
3.  配置Prometheus+Grafana监控方案，实现服务、数据库、缓存的全维度监控
4.  配置告警规则，服务异常时及时通知

## 四、全量优化方案
### 4.1 容器化优化
1.  **多阶段构建优化**：分离构建层与运行时层，镜像体积从1.8GB优化至800MB，减少55%
2.  **镜像安全优化**：使用非root用户运行容器，禁用不必要的系统权限，降低安全风险
3.  **资源限制优化**：设置CPU/内存资源限制与预留，避免服务资源抢占，提升系统稳定性
4.  **网络优化**：自定义网桥，实现服务网络隔离，减少跨容器网络延迟

### 4.2 性能优化
1.  **服务网关优化**：根据CPU核心数调整Uvicorn worker数，启用uvloop事件循环，IO性能提升100%+
2.  **数据库优化**：调整MySQL连接池大小、最大连接数、超时参数，数据库操作延迟降低40%
3.  **缓存优化**：Redis连接池优化，高频推理结果本地缓存，重复请求响应速度提升90%+
4.  **推理优化**：模型INT4/INT8量化，推理速度提升200%，内存占用降低60%
5.  **高可用优化**：新增请求超时控制、队列限流、熔断降级，服务错误率从2.1%降至0%

### 4.3 安全优化
1.  **防火墙配置**：仅放行必要端口，关闭不必要的服务，减少攻击面
2.  **数据库安全**：禁用root用户远程访问，最小权限原则配置数据库用户
3.  **接口安全**：新增API密钥认证，接口限流，防止恶意请求攻击
4.  **容器安全**：禁用容器特权模式，配置只读文件系统，限制容器系统调用

### 4.4 运维优化
1.  **自动化部署**：全流程一键部署脚本，部署时间从2小时缩短至10分钟
2.  **日志管理**：统一日志格式，配置日志轮转，方便问题排查与审计
3.  **监控告警**：全维度监控服务运行状态，异常自动告警，提升运维效率
4.  **备份恢复**：MySQL、Redis数据定时备份，实现故障快速恢复

## 五、故障排查指南
### 5.1 常见问题分类
| 问题类型 | 常见现象 | 排查方向 |
|----------|----------|----------|
| 环境类 | 依赖安装失败、命令找不到 | 系统源配置、Python版本、依赖包版本冲突 |
| 服务类 | 服务启动失败、接口访问超时 | 模型路径配置、数据库/Redis连接、端口占用 |
| 容器类 | 容器启动失败、服务无法访问 | 镜像构建错误、端口映射、网络配置、数据卷权限 |
| 性能类 | QPS低、延迟高、CPU占用过高 | worker配置、连接池设置、模型量化、资源限制 |

### 5.2 常用排查命令
```bash
# 查看服务日志
docker compose logs -f deepseek-app
# 查看容器运行状态
docker compose ps
# 查看系统资源占用
htop
# 查看端口占用情况
netstat -tulpn
# 测试接口可用性
curl http://127.0.0.1:8000/health
